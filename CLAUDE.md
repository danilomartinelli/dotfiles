# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Overview

This is a personal dotfiles repository for macOS development environment configuration. It manages system configuration, shell setup (zsh), development tools, and application settings through symlinks and automated installation scripts.

## Key Commands

### Initial Setup
```bash
# Bootstrap the entire dotfiles system (first-time setup)
script/bootstrap

# Install all dependencies and configurations
bin/dot
```

### Maintenance Commands
```bash
# Update dotfiles, brew packages, and run all installers
bin/dot

# Manually run all install scripts
script/install

# Update git configuration
script/bootstrap  # (prompts for git author info if needed)
```

### Claude-specific Setup
```bash
# Set up Claude configuration and MCP integrations
./claude/install.sh
```

## Architecture

### Core Loading Mechanism

The system is built around `zsh/zshrc.symlink` which automatically loads configuration files in a specific order:

1. **Path files** (`*/path.zsh`) - Loaded first to set up PATH
2. **Main configuration files** (`*.zsh`) - Core functionality and aliases  
3. **Completion files** (`*/completion.zsh`) - Loaded last for autocomplete

Key environment variables:
- `$ZSH` - Points to `~/.dotfiles` directory
- `$PROJECTS` - Main projects folder (`~/Code`)

**Important**: Folders starting with underscore (`_*`) are completely ignored by the loading system. This includes `_docs/`, `_archive/`, etc.

### Directory Structure

Each directory represents a topic area with its own configuration following this standard structure:

```
topic/
├── install.sh       # Installation script (optional)
├── *.symlink        # Files to be symlinked to ~/ (e.g., config.symlink → ~/.config)
├── path.zsh         # PATH modifications (optional, loaded first)
├── aliases.zsh      # Command aliases (optional)
├── env.zsh          # Environment variables (optional)
├── completion.zsh   # Shell completions (optional, loaded last)
├── *.zsh            # Other configuration files (auto-loaded)
└── config/          # Non-symlinked config files (optional)
```

**File Naming Conventions:**
- `install.sh` - Standard name for installation scripts
- `*.symlink` - Files that will be symlinked to home directory
- `path.zsh` - Must be named exactly this for PATH modifications
- `aliases.zsh` - Standard name for command aliases
- `completion.zsh` - Must be named exactly this for completions
- Files starting with `_` are ignored even in regular folders

**Special Cases:**
- `ssh/config` and `ghostty/config` - Handled by their install.sh scripts (special locations)
- `code/settings.json` and `code/keybindings.json` - Copied by install.sh, not symlinked
- `mise/mise.zsh` - Special initialization file that activates mise in the shell (not just aliases)
  - This pattern is unique to mise as it needs to hook into the shell
- `macos/` - Contains set-defaults.sh and set-hostname.sh which are called by macos/install.sh
  - Note: These scripts must keep their exact names as they contain specific functionality
  - The install.sh wrapper prevents duplicate execution when running `bin/dot`

### Symlink Management

The `script/bootstrap` script handles symlink creation:
- Finds all `*.symlink` files in the repository
- Creates symlinks in the home directory without the `.symlink` extension
- Example: `git/gitconfig.symlink` → `~/.gitconfig`

### Secret Management

- Sensitive environment variables go in `~/.localrc` (not tracked in git)
- Git author configuration stored in `git/gitconfig.local.symlink` (generated by bootstrap)
- The main gitconfig includes the local config for user-specific settings

### Tool Management

**Homebrew**: Primary package manager
- `Brewfile` - Declarative list of all brew packages and casks
- `brew bundle` - Installs everything from Brewfile

**Mise**: Runtime version manager for development tools
- `mise/mise.toml.symlink` - Global configuration
- Manages: Node.js, Python, Go, Rust, Terraform, Elixir/Erlang
- Includes pre-configured tasks for Terraform operations

## Important Implementation Notes

1. **Installation Order**: The `script/install` script runs `brew bundle` first, then executes all `install.sh` scripts found in subdirectories

2. **Shell Reloading**: After running `bin/dot`, users need to manually run `source ~/.zshrc` to reload the shell configuration

3. **macOS Defaults**: The system automatically sets macOS defaults and hostname via scripts in the `macos/` directory

4. **Claude MCP Integrations**: The Claude installation script sets up three MCP servers:
   - context7 (documentation)
   - playwright (browser automation)
   - magic (requires API key in environment)

5. **Git Configuration**: Uses a split configuration approach where public settings are in `gitconfig.symlink` and private settings (name, email) are in `gitconfig.local.symlink`