# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Overview

This is a personal dotfiles repository for macOS development environment configuration. It manages system configuration, shell setup (zsh), development tools, and application settings through symlinks and automated installation scripts.

## Key Commands

### Initial Setup
```bash
# Bootstrap the entire dotfiles system (first-time setup)
script/bootstrap

# Install all dependencies and configurations
bin/dot
```

### Maintenance Commands
```bash
# Update dotfiles, brew packages, and run all installers
bin/dot

# Manually run all install scripts
script/install

# Update git configuration
script/bootstrap  # (prompts for git author info if needed)
```

### Claude-specific Setup
```bash
# Set up Claude configuration and MCP integrations
./claude/install.sh
```

## Architecture

### Core Loading Mechanism

The system is built around `zsh/zshrc.symlink` which automatically loads configuration files in a specific order:

1. **Path files** (`*/path.zsh`) - Loaded first to set up PATH
2. **Main configuration files** (`*.zsh`) - Core functionality and aliases  
3. **Completion files** (`*/completion.zsh`) - Loaded last for autocomplete

Key environment variables:
- `$ZSH` - Points to `~/.dotfiles` directory
- `$PROJECTS` - Main projects folder (`~/Code`)

### Directory Structure

Each directory represents a topic area with its own configuration:
- `install.sh` - Installation script for that topic
- `*.symlink` - Files to be symlinked to home directory (without the .symlink extension)
- `*.zsh` - Configuration files auto-loaded by zshrc
- `path.zsh` - PATH modifications for that topic
- `aliases.zsh` - Command aliases
- `completion.zsh` - Shell completions

### Symlink Management

The `script/bootstrap` script handles symlink creation:
- Finds all `*.symlink` files in the repository
- Creates symlinks in the home directory without the `.symlink` extension
- Example: `git/gitconfig.symlink` â†’ `~/.gitconfig`

### Secret Management

- Sensitive environment variables go in `~/.localrc` (not tracked in git)
- Git author configuration stored in `git/gitconfig.local.symlink` (generated by bootstrap)
- The main gitconfig includes the local config for user-specific settings

### Tool Management

**Homebrew**: Primary package manager
- `Brewfile` - Declarative list of all brew packages and casks
- `brew bundle` - Installs everything from Brewfile

**Mise**: Runtime version manager for development tools
- `mise/mise.toml.symlink` - Global configuration
- Manages: Node.js, Python, Go, Rust, Terraform, Elixir/Erlang
- Includes pre-configured tasks for Terraform operations

## Important Implementation Notes

1. **Installation Order**: The `script/install` script runs `brew bundle` first, then executes all `install.sh` scripts found in subdirectories

2. **Shell Reloading**: After running `bin/dot`, users need to manually run `source ~/.zshrc` to reload the shell configuration

3. **macOS Defaults**: The system automatically sets macOS defaults and hostname via scripts in the `macos/` directory

4. **Claude MCP Integrations**: The Claude installation script sets up three MCP servers:
   - context7 (documentation)
   - playwright (browser automation)
   - magic (requires API key in environment)

5. **Git Configuration**: Uses a split configuration approach where public settings are in `gitconfig.symlink` and private settings (name, email) are in `gitconfig.local.symlink`